<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meeting Action Items</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #0f172a;
    color: #e2e8f0;
    line-height: 1.6;
  }

  /* --- Password Gate --- */
  #gate {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    background: #0f172a;
  }
  #gate form {
    background: #1e293b;
    padding: 2.5rem;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 4px 24px rgba(0,0,0,0.4);
    max-width: 380px;
    width: 90%;
  }
  #gate h2 { margin-bottom: 0.5rem; color: #f8fafc; }
  #gate p { color: #94a3b8; margin-bottom: 1.5rem; font-size: 0.9rem; }
  #gate input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid #334155;
    border-radius: 8px;
    background: #0f172a;
    color: #e2e8f0;
    font-size: 1rem;
    margin-bottom: 1rem;
    outline: none;
  }
  #gate input:focus { border-color: #3b82f6; }
  #gate button {
    width: 100%;
    padding: 0.75rem;
    background: #3b82f6;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
    font-weight: 600;
  }
  #gate button:hover { background: #2563eb; }
  #gate .error { color: #f87171; font-size: 0.85rem; margin-top: 0.5rem; display: none; }

  /* --- Dashboard --- */
  #dashboard { display: none; }

  header {
    background: #1e293b;
    border-bottom: 1px solid #334155;
    padding: 1.25rem 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  header h1 { font-size: 1.35rem; color: #f8fafc; }
  .updated { color: #64748b; font-size: 0.8rem; }

  .stats-bar {
    display: flex;
    gap: 1rem;
    padding: 1.25rem 2rem;
    flex-wrap: wrap;
  }
  .stat-card {
    background: #1e293b;
    border: 1px solid #334155;
    border-radius: 10px;
    padding: 1rem 1.5rem;
    flex: 1;
    min-width: 150px;
  }
  .stat-card .label { color: #94a3b8; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; }
  .stat-card .value { font-size: 1.75rem; font-weight: 700; color: #f8fafc; margin-top: 0.25rem; }
  .stat-card.open .value { color: #f59e0b; }
  .stat-card.progress .value { color: #3b82f6; }
  .stat-card.done .value { color: #22c55e; }
  .stat-card.meetings .value { color: #a78bfa; }

  main { padding: 0 2rem 2rem; }

  section { margin-bottom: 2rem; }
  section h2 {
    font-size: 1.1rem;
    color: #cbd5e1;
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #1e293b;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: #1e293b;
    border-radius: 10px;
    overflow: hidden;
  }
  thead th {
    background: #334155;
    color: #94a3b8;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.75rem 1rem;
    text-align: left;
    font-weight: 600;
  }
  tbody td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #293548;
    font-size: 0.9rem;
  }
  tbody tr:last-child td { border-bottom: none; }
  tbody tr:hover { background: #253349; }

  .badge {
    display: inline-block;
    padding: 0.2rem 0.6rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }
  .badge.open { background: #422006; color: #fbbf24; }
  .badge.in-progress { background: #172554; color: #60a5fa; }
  .badge.completed { background: #052e16; color: #4ade80; }
  .badge.overdue { background: #450a0a; color: #f87171; }

  .empty { color: #475569; font-style: italic; padding: 1.5rem; text-align: center; }

  @media (max-width: 768px) {
    header { padding: 1rem; }
    .stats-bar { padding: 1rem; }
    main { padding: 0 1rem 1rem; }
    table { font-size: 0.8rem; }
    thead th, tbody td { padding: 0.5rem; }
  }
</style>
</head>
<body>

<!-- Password Gate -->
<div id="gate">
  <form id="loginForm">
    <h2>Meeting Dashboard</h2>
    <p>Enter password to continue</p>
    <input type="password" id="pwInput" placeholder="Password" autocomplete="off" autofocus>
    <button type="submit">Unlock</button>
    <div class="error" id="pwError">Incorrect password</div>
  </form>
</div>

<!-- Dashboard -->
<div id="dashboard">
  <header>
    <h1>Meeting Action Items</h1>
    <span class="updated" id="lastUpdated"></span>
  </header>

  <div class="stats-bar">
    <div class="stat-card open"><div class="label">Open</div><div class="value" id="statOpen">0</div></div>
    <div class="stat-card progress"><div class="label">In Progress</div><div class="value" id="statProgress">0</div></div>
    <div class="stat-card done"><div class="label">Completed</div><div class="value" id="statDone">0</div></div>
    <div class="stat-card meetings"><div class="label">Meetings</div><div class="value" id="statMeetings">0</div></div>
  </div>

  <main>
    <section>
      <h2>Open Action Items</h2>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Action Item</th>
            <th>Owner</th>
            <th>Due Date</th>
            <th>Status</th>
            <th>Meeting</th>
          </tr>
        </thead>
        <tbody id="openItems"></tbody>
      </table>
    </section>

    <section>
      <h2>Completed</h2>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Action Item</th>
            <th>Owner</th>
            <th>Completed</th>
            <th>Meeting</th>
          </tr>
        </thead>
        <tbody id="completedItems"></tbody>
      </table>
    </section>

    <section>
      <h2>Recent Meetings</h2>
      <table>
        <thead>
          <tr>
            <th>Meeting</th>
            <th>Date</th>
            <th>Participants</th>
            <th>Action Items</th>
          </tr>
        </thead>
        <tbody id="meetingLog"></tbody>
      </table>
    </section>
  </main>
</div>

<script>
const HASH = "21fe4f465e08689650fb8cebe984cdb622a776f678a90558c90901325cebd887";

async function sha256(text) {
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(text));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, "0")).join("");
}

function isUnlocked() {
  return sessionStorage.getItem("dash_unlocked") === "1";
}

// --- Auth ---
if (isUnlocked()) showDashboard();

document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const pw = document.getElementById("pwInput").value;
  const hash = await sha256(pw);
  if (hash === HASH) {
    sessionStorage.setItem("dash_unlocked", "1");
    showDashboard();
  } else {
    document.getElementById("pwError").style.display = "block";
    document.getElementById("pwInput").value = "";
  }
});

async function showDashboard() {
  document.getElementById("gate").style.display = "none";
  document.getElementById("dashboard").style.display = "block";
  await loadData();
}

// --- Data ---
async function loadData() {
  try {
    const res = await fetch("data.json?t=" + Date.now());
    const data = await res.json();
    render(data);
  } catch (e) {
    console.error("Failed to load data:", e);
  }
}

function render(data) {
  // Last updated
  if (data.lastUpdated) {
    const d = new Date(data.lastUpdated);
    document.getElementById("lastUpdated").textContent = "Updated " + d.toLocaleString();
  }

  const items = data.actionItems || [];
  const open = items.filter(i => i.status === "open" || i.status === "in-progress");
  const done = items.filter(i => i.status === "completed");
  const inProg = items.filter(i => i.status === "in-progress");

  // Stats
  document.getElementById("statOpen").textContent = open.filter(i => i.status === "open").length;
  document.getElementById("statProgress").textContent = inProg.length;
  document.getElementById("statDone").textContent = done.length;
  document.getElementById("statMeetings").textContent = (data.meetings || []).length;

  // Open items
  const openTbody = document.getElementById("openItems");
  if (open.length === 0) {
    openTbody.innerHTML = '<tr><td colspan="6" class="empty">No open action items</td></tr>';
  } else {
    openTbody.innerHTML = open.map(i => {
      const overdue = i.dueDate && new Date(i.dueDate) < new Date() && i.status !== "completed";
      const statusClass = overdue ? "overdue" : i.status;
      const statusLabel = overdue ? "Overdue" : i.status;
      return `<tr>
        <td>${i.id}</td>
        <td>${esc(i.item)}</td>
        <td>${esc(i.owner || "—")}</td>
        <td>${i.dueDate || "—"}</td>
        <td><span class="badge ${statusClass}">${statusLabel}</span></td>
        <td>${esc(i.meetingTitle || "—")}<br><small style="color:#64748b">${i.meetingDate || ""}</small></td>
      </tr>`;
    }).join("");
  }

  // Completed items
  const doneTbody = document.getElementById("completedItems");
  if (done.length === 0) {
    doneTbody.innerHTML = '<tr><td colspan="5" class="empty">No completed items yet</td></tr>';
  } else {
    doneTbody.innerHTML = done.map(i => `<tr>
      <td>${i.id}</td>
      <td>${esc(i.item)}</td>
      <td>${esc(i.owner || "—")}</td>
      <td>${i.completedDate || "—"}</td>
      <td>${esc(i.meetingTitle || "—")}</td>
    </tr>`).join("");
  }

  // Meetings
  const mtgTbody = document.getElementById("meetingLog");
  const meetings = data.meetings || [];
  if (meetings.length === 0) {
    mtgTbody.innerHTML = '<tr><td colspan="4" class="empty">No meetings processed yet</td></tr>';
  } else {
    mtgTbody.innerHTML = meetings.slice().reverse().map(m => `<tr>
      <td>${esc(m.title)}</td>
      <td>${m.date || "—"}</td>
      <td>${esc((m.participants || []).join(", "))}</td>
      <td>${m.actionItemCount ?? "—"}</td>
    </tr>`).join("");
  }
}

function esc(s) {
  const d = document.createElement("div");
  d.textContent = s || "";
  return d.innerHTML;
}
</script>
</body>
</html>
